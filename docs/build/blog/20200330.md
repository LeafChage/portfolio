<!--
 Date: 2020/03/30
 Title: Bashでsshコマンドの補完拡張してみた
 Tag: #Bash #ssh
 -->

# Bashでsshコマンドの補完拡張してみた
AWSのEC2の複数のサーバーに入るので ssh/.config を使って管理しています。 [こんな感じで](https://mako-note.com/ssh-config/)
その補完が欲しくて自分で書いてみました。

```bash
#!/bin/bash
SSH_CONFIG=~/.ssh/config

sshlist() {
    # .ssh/configからHost名だけとってきて表示
    awk '$1=="Host" {print $2}' "$SSH_CONFIG"
}

make_completion_words() {
    # $COMP_CWORD : 今のwordの数
    # $COMP_WORDS : 今のword
    if [ "$COMP_CWORD" = "1" ]; then
        # ssh_listコマンドの改行削除
        ssh_list_line=`sshlist | sed -e ':a' -e 'N' -e '$!ba' -e 's/\n/ /g'`

        # COMPREPLY の変数の中に配列で入れると補完してくれる
        COMPREPLY=($(compgen -W "${ssh_list_line}" -- "${COMP_WORDS[$COMP_CWORD]}"))
    fi
}

# 補完関数の登録
complete -o bashdefault -o default -o nospace -F make_completion_words ssh
```

↑これを適当な名前(.ssh_completion.bash)で保存して、
```
source ./.ssh_completion.bash
```
とかで読み込めば補完できます。
僕はbash_profileに上記の一文追加しています。

参考にしたのは[この記事](https://blog.cybozu.io/entry/2016/09/26/080000)です！
